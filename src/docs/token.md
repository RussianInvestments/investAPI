# Токен для работы с T-Invest API

Токен — это набор символов, в котором зашифрована информация о владельце, правах доступа 
и другой необходимой информации для авторизации в T-Invest API. В процессе работы с T-Invest API токен нужно передавать в metadata каждого unary-запроса, а также в запросах на установление всех видов stream-соединений.

> **Важно**<br>
> Работать с T-Invest API без токена нельзя.

## Виды токенов

В T-Invest API есть несколько видов токенов с разным набором прав — вы
можете выпустить несколько токенов для решения разных задач алгоритмической торговли или
мониторинга рынка ценных бумаг.

<ul>
<li><p><strong>Readonly token</strong> — токен для получения информации: например, состояние портфеля, расписание торгов различных торговых площадок, текущие котировки, исторические данные. С этим типом токена нельзя выставлять торговые поручения.</p>
</li>
<li><p><strong>Full-access token</strong> — токен для работы со всеми методами T-Invest API. Это основной тип токена для реальной работы с API.</p>
</li>
<li><p><strong>Токен с доступом к конкретному счёту</strong> — токен для получения доступа только к одному конкретному счёту пользователя. Уровень прав доступа (readonly, full-access) также можно настроить.</p>
</li>
<li><p><strong>Sandbox token</strong> — токен для работы с <a href="https://russianinvestments.github.io/investAPI/head-sandbox/">песочницей</a>. Песочница — это эмуляция работы торговых площадок, основанная на реальных данных, но не ведущая к изменению состава портфеля или баланса вашего счёта. Токен предназначен для тестирования вашего робота и проверки работоспособности всех алгоритмов.</p>
<p>Если использовать этот токен для обычных методов и стримов, вернётся ошибка.</p>
</li>
</ul>

## Получить токен

<ol>
<li><p>Перейдите в <a href="https://www.tbank.ru/invest/settings/">настройки профиля Т-Инвестиции</a> и авторизуйтесь в системе, если это требуется.</p>
<p>Функция <strong>Подтверждение сделок кодом</strong> должна быть отключена. </p>
<blockquote>
<p><strong>Важно</strong><br>
Сделки на сумму больше 30 000 000 рублей требуют подтверждения и будут недоступны через API.</p>
</blockquote>
</li>
<li><p>Выпустите токен T-Invest API для биржи и/или песочницы. Возможно, система попросит вас авторизоваться ещё раз — это нужно для подключения робота к торговой платформе.</p>
</li>
<li>Скопируйте токен и сохраните его. Токен отображается только один раз, просмотреть его позже не
получится. Вы можете выпускать неограниченное количество токенов.</li>
</ol>

## Срок жизни токена

Срок жизни токена — три месяца с даты последнего использования. 

Убедитесь, что ваши обращения выполняются с актуальным токеном. Если вы получили 40003 ошибку, это значит, что токен неактуальный. 

Пример ошибки:


```
"code": "40003"
"message": "authentication token is missing or invalid"
```

Токен может перестать быть актуальным, если:

- Пользователь перестал быть клиентом Т-Инвестиций.
- Пользователь завершил активные сессии для всех устройств.
- Аккаунт пользователя заблокировали.
- Карту пользователя заблокировали.
- Токен отозвали.

## Отозвать токен

Отозвать токен T-Invest API можно [в личном кабинете](https://id.tbank.ru/account).