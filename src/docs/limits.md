# Лимиты T-Invest API

В процессе работы торговые роботы могут генерировать огромное количество заявок. 
Особенность алгоритмической торговли — большой процент отмен заявок, и пользователи 
могут генерировать большую нагрузку на инфраструктуру брокера. Поэтому у T-Invest API
есть система динамического формирования лимитов для пользователей.

Для всех запросов с одного адреса установлено суммарное ограничение. Мы рекомендуем разрабатывать роботов таким образом, чтобы общее число запросов по всем счетам и токенам в секунду не превышало 50.

>**Важно**<br>
>Значение лимита конкретного сервиса включает в себя суммарное количество допустимых запросов по всем методам этого сервиса.<br><br>
>Лимитная политика распространяется на все аккаунты (cчета) пользователя.

## Таблица лимитов unary-методов

| Сервисы                                                                    | Способ интеграции | Лимит unary-запросов в минуту |
|:---------------------------------------------------------------------------|:------------------|:------------------------------|
| [Сервис инструментов](/investAPI/head-instruments/)                        | gRPC<br/>REST     | 200                           |
| [Сервис счетов](/investAPI/head-users/)                                    | gRPC<br/>REST     | 100                           |
| [Сервис операций](/investAPI/head-operations/)                             | gRPC<br/>REST     | 200                           |
| Формирование отчётов в</br>[сервисе операций](/investAPI/head-operations/) | gRPC              | 5                             |
| [Сервис котировок](/investAPI/head-marketdata/)                            | gRPC<br/>REST     | 600                           |
| [Сервис стоп-ордеров](/investAPI/head-stoporders/)                         | gRPC<br/>REST     | 50                            |
| [Песочницы](/investAPI/head-sandbox/)                                      | gRPC<br/>REST     | 200                           |
| [Сервис ордеров](/investAPI/head-orders/)                                  | gRPC<br/>REST     | 100                           |
| Метод [getHistory](/investAPI/get_history)          | REST              | 30                            |
| Метод [getOrders](/investAPI/orders#getorders)       | gRPC<br/>REST     | 200                           |
| Метод [postOrder](/investAPI/orders#postorder)         | gRPC<br/>REST     | 300                           |
| Метод [cancelOrder](/investAPI/orders#cancelorder)     | gRPC<br/>REST     | 100                           |
| Метод [postOrderAsync](/investAPI/orders/#postorderasync)     | gRPC<br/>REST     | 450                           |

## Грейды

Есть 5 уровней доступа, которые зависят от количества выставленных заявок любого типа и
процента их исполнения.

| Лимитный грейд   | Активных stream-соединений</br>[сервиса котировок](/investAPI/head-marketdata/) | Активных stream-соединений на каждый метод</br>[сервиса ордеров](/investAPI/head-orders/) | Активных stream-соединений на каждый метод</br>[сервиса операций](/investAPI/head-operations/) |
| :-------------   |:--------------------------------------------------------------------------------|:--------------------------------------------------------------------------|:-------------------------------------------------------------------------------|
| 1                | 16                                                                               | 10                                                                         | 2                                                                              |
| 2                | 16                                                                               | 10                                                                         | 2                                                                              |
| 3                | 16                                                                               | 10                                                                         | 2                                                                              |
| 4                | 16                                                                               | 16                                                                         | 2                                                                              |
| 5                | 64                                                                               | 16                                                                         | 2                                                                              |

>**Важно**<br>
>В рамках одного stream-соединения [сервиса котировок](/investAPI/head-marketdata/) есть 
ограничение в 300 одновременных подписок на свечи, стаканы и ленту обезличенных сделок. Лимит считается
суммарно по всем трём типам данных. Лимитов на количество подписок в рамках одного стрима на торговые
статусы инструментов (подписка Info) нет.<br><br>
>В методе [Запросить тариф пользователя](https://russianinvestments.github.io/investAPI/users/#getusertariff) лимиты для стрим-соединений могут возвращаться на 1 больше. Это сделано для того, чтобы вы могли переподключить стримы — поэтому мы не рекомендуем использовать максимальное количество из лимита. <br><br>
>Если превысить лимит, вернётся соответствующая ошибка. Превышения не будет, если количество запросов с IP-адреса клиента не превышает 1000 в минуту. Если вы подозреваете, что ваш IP-адрес забанили — обратитесь к нам в поддержку или в [Telegram-чат по общим вопросам](https://t.me/joinchat/VaW05CDzcSdsPULM). <br><br>
>Воспользоваться максимальными лимитами по выставленю ордеров получится не всегда из-за задержек на стороне брокера. Увеличение лимита в первую очередь полезно для клиентов, торгующих с разных счетов. Подробнее по производительность читайте на [странице](/investAPI/speedup/).

Счётчик количества стрим-соединений обновляется каждые 2 минуты.

Лимитный грейд пользователя изменяется раз в сутки после окончания торгов. Для изменения
грейда берётся статистика заявок, выполненных пользователем за последние 30 дней от текущей даты. 
Чем больше пользователь выставляет заявок при сохранении высокого уровня исполнения, тем выше его лимиты.

>**Важно**<br>
>Лимита на количество активных заявок нет.

## Расчёт грейдов

Лимитные грейды рассчитываются только для пользователей T-Invest API, которые выставляли заявки. Если вы не используете эту версию API для выставления заявок, у вас будет первый грейд. Чтобы грейд рассчитывался, нужно выставлять хотя бы одну заявку в месяц.

| Количество исполненных заявок / </br> процент исполнения | Больше 50% | Больше 10% | Больше 2% | Меньше 2% |
|:---------------------------------------------------------|:-----------| :--------- | :--------- |:----------|
| Меньше **10**                                            | 1          | 1          | 1          | 1         | 
| Меньше **200**                                           | 2          | 2          | 2          | 1         | 
| Меньше **1 000**                                         | 4          | 3          | 2          | 1         | 
| Меньше **5 000**                                         | 5          | 4          | 3          | 1         | 
| Меньше **10 000**                                        | 5          | 5          | 4          | 2         | 
| Больше **10 000**                                        | 5          | 5          | 4          | 2         | 


## Ограничения по доставке данных в стримах

В пики активности на бирже возможны ситуации, когда за одну секунду происходят сотни событий по инструменту.
Для ограничения нагрузки на клиентов и на сервис были введены интервалы отправки сообщений в стрим.
За один интервал времени может быть отправлено только одно сообщение по одной подписке.
Значения в миллисекундах приведены в таблице:

| Тип подписки | Величина интервала |
|:---------------------|:-------------------------|
| Trades               | без ограничений          | 
| Orderbook            | 100                      | 
| Candles              | 100                      | 
| LastPrice            | без ограничений          | 
| Info                 | без ограничений          | 